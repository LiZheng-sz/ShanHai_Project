<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>山海寻灵 | Dy搜立正</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.css" rel="stylesheet">
    <link href="https://fonts.loli.net/css2?family=ZCOOL+XiaoWei&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    
    <div class="paper-texture"></div>
    <canvas id="particle-canvas"></canvas>
    <div id="cursor-dot"></div>
    <div id="cursor-outline"></div>

    <div id="intro-gate">
        <div class="loader-wrapper">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
        </div>
        <div class="loader-text">山海寻灵</div>
        <div style="margin-top:10px; color:#666; font-size:12px; opacity:0; animation:fadeInUp 1s forwards 1s;">正在扫描山海大陆...</div>
    </div>

    <nav class="navbar">
          <div class="logo">
              <img src="assets/logo.png" alt="Logo" class="logo-img"> 
              <span></span>
          </div>
        <div class="nav-items">	
            <button class="nav-btn active" onclick="switchView('home', this)" data-hover><i class="fa-solid fa-house"></i> 首页</button>
            <button class="nav-btn" onclick="switchView('dex', this)" data-hover><i class="fa-solid fa-book-journal-whills"></i> 啾灵图鉴</button>
            <button class="nav-btn" onclick="switchView('craft', this)" data-hover><i class="fa-solid fa-scroll"></i> 天工造物</button>
            <button class="nav-btn" onclick="switchView('map', this)" data-hover><i class="fa-solid fa-map-location"></i> 山海大陆</button>
            <button class="nav-btn" onclick="switchView('breed', this)" data-hover><i class="fa-solid fa-yin-yang"></i> 啾灵融合</button>
        </div>
    </nav>

    <div class="main-container">
        <div id="home" class="view-section active">
            <div class="home-dashboard">
               <div class="hero-banner" data-hover onclick="window.open('https://ymzx.qq.com/', '_blank')" style="cursor: pointer;">
                    <video autoplay muted loop playsinline class="hero-video" poster="assets/banner-fallback.jpg">
                        <source src="background.mp4" type="video/mp4">
                    </video>
                    <div class="hero-overlay"></div>
                    <div class="hero-content">
                        <h1 style="margin:0 0 10px 0; font-size:32px; color:var(--accent);">欢迎回到山海大陆</h1>
                        <p style="margin:0; opacity:0.9; font-size:16px;">捕捉啾灵，记录奇迹 | 当前版本 v3.4</p>
                    </div>
                    <div class="hero-icon" style="font-size:100px; color:rgba(255,255,255,0.3); transform: rotate(-15deg); z-index: 2;">
                        <i class="fa-solid fa-scroll"></i>
                    </div>
                </div>

                <div style="display:flex; flex-direction:column; gap:30px;">
                    <div class="panel-box">
                        <div class="panel-header" style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                            <span style="font-size:18px; font-weight:bold; color:var(--primary);"><i class="fa-solid fa-bullhorn" style="color:var(--accent); margin-right:8px;"></i> 星梦快报</span>
                            <span style="font-size:12px; color:#999; cursor:pointer;" data-hover>更多 ></span>
                        </div>
                        <div class="news-list" id="news-container"></div>
                    </div>

                    <div class="panel-box">
                        <div class="panel-header" style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                            <span style="font-size:18px; font-weight:bold; color:var(--primary);"><i class="fa-solid fa-chart-pie" style="color:var(--accent); margin-right:8px;"></i> 观测报告</span>
                        </div>
                        <div class="report-stats">
                            <div class="stat-box">
                                <div class="stat-num" id="stat-count">0</div>
                                <div class="stat-label">已收录啾灵</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-num" id="stat-seen">12</div>
                                <div class="stat-label">今日目击</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-box">
                    <div class="panel-header" style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                        <span style="font-size:18px; font-weight:bold; color:var(--primary);"><i class="fa-solid fa-compass" style="color:var(--accent); margin-right:8px;"></i> 探险手记</span>
                    </div>
                    <div class="guide-grid" id="guide-container"></div>
                </div>
            </div>
        </div>

        <div id="dex" class="view-section">
            <div class="search-container">
                <input type="text" class="glass-input" id="dexSearch" placeholder="搜索啾灵名称..." oninput="filterDex()">
                <select class="glass-select" id="dexFilter" onchange="filterDex()" data-hover>
                    <option value="all">全属性</option>
                    <option value="金">金系</option>
                    <option value="木">木系</option>
                    <option value="水">水系</option>
                    <option value="火">火系</option>
                    <option value="土">土系</option>
                </select>
            </div>

            <div class="dex-layout-container">
                <div class="dex-sidebar">
                    <div class="dex-list" id="dex-list"></div>
                </div>

                <div class="dex-main-content">
                    <div class="mobile-back-btn" onclick="backToDexList()">
                           <i class="fa-solid fa-arrow-left"></i> 返回列表
                    </div>
                    <div class="dex-tabs">
                        <div class="dex-tab">分布地区</div>
                        <div class="dex-tab active">形态特征</div>
                    </div>

                    <div class="dex-detail-card" id="dex-detail-view">
                        <div class="empty-state">请在左侧选择一只啾灵查看详情</div>
                        
                        <div class="detail-grid" style="display:none;" id="detail-content">
                            <div class="visual-area">
                                <div class="visual-circle"></div> <img src="" alt="" class="creature-big-img" id="detail-img">
                                <div class="bg-deco-text">NO.<span id="detail-id">000</span></div>
                            </div>

                            <div class="info-panel">
                                <div class="info-header">
                                    <h2 id="detail-name">啾灵名称</h2>
                                    <div class="element-badge" id="detail-element"><i class="fa-solid fa-fire"></i></div>
                                </div>
                                <div class="info-row">
                                    <label>职业:</label>
                                    <div class="role-tag" id="detail-role">
                                        <i class="fa-solid fa-fist-raised"></i> 输出
                                    </div>
                                </div>
                                <div class="info-section">
                                    <label>工作适应性:</label>
                                    <div class="work-icons" id="detail-work"></div>
                                </div>
                                <div class="info-section">
                                    <label>立正锐评:</label>
                                    <div class="drop-items" id="detail-drops"></div>
                                </div>
                            </div>

                            <div class="desc-footer">
                                <div class="catch-rate">
                                    <span class="label">稀有度:</span>
                                    <div class="pokeballs">
                                        <i class="fa-regular fa-circle-check" style="color:#aaa;"></i>
                                        <i class="fa-regular fa-circle-check" style="color:#aaa;"></i>
                                        <i class="fa-regular fa-circle-check" style="color:#aaa;"></i>
                                    </div>
                                </div>
                                <div class="desc-text-box">
                                    <p id="detail-desc">这里是描述文本...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<div id="craft" class="view-section">
    <div class="craft-layout">
        <div class="craft-sidebar">
            <div class="search-container" style="margin: 0 0 20px 0; position:relative; top:0;">
                <input type="text" class="glass-input" id="craftSearch" placeholder="搜索配方 (如: 鞍具, 碳纤维)..." oninput="app.filterCraft()">
            </div>
            <div id="recipe-list" class="craft-list-container"></div>
        </div>

        <div class="craft-main">
            <div id="blueprint-panel" class="blueprint-card">
                <div class="empty-state-craft">
                    <i class="fa-solid fa-compass-drafting" style="font-size: 48px; margin-bottom: 20px; color:#ddd;"></i>
                    <p>选择左侧配方进行解析</p>
                </div>
                
                <div id="craft-detail-content" style="display:none;">
                    <div class="blueprint-header">
                        <h2 id="bp-name">物品名称</h2>
                        <div class="bp-meta">
                            <span id="bp-type" class="bp-tag">类型</span>
                            <span id="bp-yield" class="bp-tag warning">产量: 1</span>
                        </div>
                    </div>

                    <div class="calc-control">
                        <label>制作数量:</label>
                        <div class="stepper">
                            <button onclick="app.updateCraftCalc(-1)">-</button>
                            <input type="number" id="calc-qty" value="1" min="1" onchange="app.calcCraftMaterials()">
                            <button onclick="app.updateCraftCalc(1)">+</button>
                        </div>
                    </div>

                    <div class="blueprint-body">
                        <div class="bp-tabs">
                            <div class="bp-tab active" onclick="app.switchBpTab('raw')" id="tab-raw">基础材料统计</div>
                            <div class="bp-tab" onclick="app.switchBpTab('tree')" id="tab-tree">合成树状图</div>
                        </div>

                        <div id="view-raw" class="bp-view active">
                            <div id="raw-mat-list" class="mat-grid"></div>
                        </div>

                        <div id="view-tree" class="bp-view">
                            <div id="tree-container" class="tree-wrapper"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        <div id="map" class="view-section">
            <div id="map-container" class="map-wrapper" style="width: 100%; height: 100%;"></div>

            <div class="mobile-map-btn" onclick="toggleMapControls()" data-hover>
                <img src="assets/orb.png" alt="图层">
            </div>

            <div class="map-layer-control" id="map-controls">
                <div class="control-header-mobile">
                    <span>地图工具</span>
                    <i class="fa-solid fa-times" onclick="toggleMapControls()"></i>
                </div>

                <div class="control-section">
                    <div class="section-title">图层筛选</div>
                    <div class="layer-toggle active" onclick="toggleLayer('orb', this)" data-hover>
                        <img src="assets/orb.png"> 灵珠
                    </div>
                    <div class="layer-toggle active" onclick="toggleLayer('chest', this)" data-hover>
                        <img src="assets/chest.png"> 宝箱
                    </div>
                    <div class="layer-toggle active" onclick="toggleLayer('teleport', this)" data-hover>
                        <img src="assets/teleport.png"> 传送点
                    </div>
                    <div class="layer-toggle active" onclick="toggleLayer('user', this)" data-hover>
                        <img src="assets/user.png"> 野外boss
                    </div>
                </div>

                <div class="control-section" style="border-top: 1px dashed #ddd; margin-top: 10px; padding-top: 10px;">
                    <div class="section-title">数据管理</div>
                    <div class="layer-toggle" onclick="exportMapData()" data-hover>
                        <i class="fa-solid fa-download"></i> 导出备份
                    </div>
                    <div class="layer-toggle" onclick="triggerImport()" data-hover>
                        <i class="fa-solid fa-upload"></i> 导入数据
                    </div>
                    <input type="file" id="import-input" style="display: none;" accept=".json" onchange="importMapData(this)">
                </div>
            </div>
        </div>

        <div id="breed" class="view-section">
            <div class="breed-stage">
                <h2 style="color:var(--primary); margin-bottom:15px; font-size:28px;">啾灵融合公式</h2>
                <p style="color:#888; font-style:italic;">天地交感，万物化生。选择父母灵兽进行推演。</p>
                
                <div class="calc-row">
                    <select id="p1" class="calc-select" onchange="checkBreed()" data-hover><option>选择父本</option></select>
                    <i class="fa-solid fa-plus icon-plus"></i>
                    <select id="p2" class="calc-select" onchange="checkBreed()" data-hover><option>选择母本</option></select>
                    <i class="fa-solid fa-arrow-right icon-eq"></i>
                    <div class="result-egg-container">
                        <div class="result-egg" id="result-egg"><i class="fa-solid fa-egg"></i></div>
                        <div class="egg-glow"></div>
                    </div>
                </div>
                <div id="result-name" style="margin-top:30px; font-size:26px; font-weight:bold; color:var(--primary);">???</div>
            </div>
        </div>
    </div>

    <div id="marker-modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title" style="font-size:18px; font-weight:bold;">地点详情</div>
                <div class="modal-close" onclick="closeModal()" data-hover style="cursor:pointer;"><i class="fa-solid fa-times"></i></div>
            </div>
            
            <div class="modal-body" style="padding:25px; overflow-y:auto; max-height: 60vh;">


                <div class="form-group">
                    <label style="display:block; font-size:12px; color:#888; margin-bottom:5px;">标记名称</label>
                    <input type="text" id="marker-name" class="form-input">
                </div>

                <div class="form-group">
                    <label style="display:block; font-size:12px; color:#888; margin-bottom:5px;">备注信息</label>
                    <textarea id="marker-desc" class="form-textarea" style="height:60px; resize:none;"></textarea>
                </div>

                <div class="form-group">
                    <label style="display:block; font-size:12px; color:#888; margin-bottom:5px;">标记类型</label>
                    <select id="marker-type" class="form-select">
                        <option value="user">🚩 野外boss</option>
                        <option value="orb">🔵 灵珠</option>
                        <option value="chest">📦 宝箱</option>
                        <option value="teleport">⛩️ 传送点</option>
                    </select>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('marker-img-input').click()" data-hover>
                    <i class="fa-solid fa-cloud-arrow-up upload-icon" style="font-size:30px; color:#ccc; margin-bottom:10px;"></i>
                    <div class="upload-text" style="color:#999; font-size:13px;">点击上传现场图片</div>
                    <img id="marker-img-preview" class="upload-preview" alt="Preview">
                    <input type="file" id="marker-img-input" accept="image/*" style="display:none" onchange="handleImageUpload(this)">
                </div>

                <input type="hidden" id="marker-lat">
                <input type="hidden" id="marker-lng">
                <input type="hidden" id="marker-id">
            </div>

            <div class="modal-footer" style="padding:20px; background:#f9f9f9; display:flex; gap:10px;">
                <button class="btn btn-primary" onclick="saveMarkerData()" data-hover>保存记录</button>
                <button class="btn btn-danger" id="btn-delete" onclick="deleteCurrentMarker()" data-hover>删除</button>
            </div>
        </div>
    </div>

<!--版权申明 -->
<footer style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
    © 2024 山海寻灵. 版权所有. 未经授权禁止复制、转载或建立镜像.
</footer>

    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="js/data.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>

</body> 
</html>