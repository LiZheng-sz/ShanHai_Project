<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±æµ·å¯»çµ - äº¤äº’å¼åœ°å›¾åŠ©æ‰‹ï¼ˆå›½å†…æé€Ÿç‰ˆï¼‰</title>
    
    <link href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.css" rel="stylesheet">
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: "Microsoft YaHei", sans-serif; overflow: hidden; background: #333; }
        
        #map { width: 100%; height: 100%; background: #f0e6d2; }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: absolute;
            top: 20px; left: 20px;
            width: 240px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        .sidebar h3 { margin: 0 0 10px 0; border-bottom: 2px solid #8b4513; padding-bottom: 5px; color: #333; }
        
        .filter-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; user-select: none; }
        .filter-item input { margin-right: 8px; cursor: pointer; }

        /* åæ ‡æ˜¾ç¤º */
        .coords-display {
            position: absolute; bottom: 10px; right: 10px;
            background: rgba(0, 0, 0, 0.7); color: #fff;
            padding: 5px 12px; border-radius: 4px; font-size: 13px;
            z-index: 1000; pointer-events: none;
        }

        /* ç®€å•çš„å›¾æ ‡å˜è‰²é€»è¾‘ */
        .icon-monster { filter: hue-rotate(0deg); }   /* è“è‰² */
        .icon-resource { filter: hue-rotate(140deg); } /* ç»¿è‰² */
        .icon-special { filter: hue-rotate(280deg); }  /* ç´«è‰² */
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>åœ°å›¾ç­›é€‰</h3>
        <label class="filter-item"><input type="checkbox" checked onchange="toggleLayer('monster')"> ğŸ¦ ç¨€æœ‰çµå…½</label>
        <label class="filter-item"><input type="checkbox" checked onchange="toggleLayer('resource')"> ğŸ’ ç¨€æœ‰çŸ¿çŸ³</label>
        <label class="filter-item"><input type="checkbox" checked onchange="toggleLayer('special')"> â›©ï¸ ä¼ é€ç‚¹</label>
        <div style="margin-top:10px; font-size:12px; color:#666;">
            æç¤ºï¼šå½“å‰ä¸ºçº¯è‰²åº•å›¾æµ‹è¯•æ¨¡å¼ã€‚<br>ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®æŸ¥çœ‹åæ ‡ã€‚
        </div>
    </div>

    <div class="coords-display" id="coords">åæ ‡: [0, 0]</div>
    <div id="map"></div>

    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <script>
        // æ£€æŸ¥JSæ˜¯å¦åŠ è½½æˆåŠŸ
        if (typeof L === 'undefined') {
            alert("é”™è¯¯ï¼šåœ°å›¾æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å°è¯•åˆ·æ–°é¡µé¢ã€‚");
        }

        // --- 1. åˆå§‹åŒ–åœ°å›¾ ---
        // CRS.Simple è¡¨ç¤ºè¿™æ˜¯å¹³é¢åœ°å›¾ï¼ˆæ¸¸æˆåœ°å›¾ï¼‰ï¼Œä¸æ˜¯åœ°çƒç»çº¬åº¦
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -3,
            maxZoom: 2,
            zoomSnap: 0.5 // å…è®¸åŠçº§ç¼©æ”¾
        });

        // --- 2. è®¾ç½®åœ°å›¾åº•å›¾ ---
        // å®šä¹‰åœ°å›¾å¤§å°ï¼šå‡è®¾åœ°å›¾æ˜¯ 2000x2000 åƒç´ 
        const w = 2000;
        const h = 2000;
        const bounds = [[0, 0], [h, w]];

        // ã€ä¿®æ”¹ç‚¹3ï¼šæš‚æ—¶ä¸åŠ è½½å›¾ç‰‡ï¼Œåªç”¨é¢œè‰²å—ä»£æ›¿ã€‘
        // ä»¥åä½ æœ‰å›¾ç‰‡äº†ï¼ŒæŠŠä¸‹é¢è¿™è¡Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æŠŠ url æ¢æˆä½ çš„å›¾ç‰‡è·¯å¾„
        L.imageOverlay('å±±æµ·å¤§é™†åœ°å›¾.png', bounds).addTo(map);

        // è¿™é‡Œä¸ºäº†ä¿è¯ä½ ä¸€å®šèƒ½çœ‹åˆ°ä¸œè¥¿ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªçº¢è‰²çš„çŸ©å½¢æ¡†ä»£è¡¨åœ°å›¾è¾¹ç•Œ
        L.rectangle(bounds, {color: "#ff7800", weight: 2, fill: false}).addTo(map);
        map.fitBounds(bounds);

        // --- 3. æ¨¡æ‹Ÿæ•°æ® ---
        const mapData = [
            { type: 'monster', name: 'BOSS: ä¹å°¾ç‹', x: 1000, y: 1000, desc: 'åœ°å›¾æ­£ä¸­å¿ƒ' },
            { type: 'monster', name: 'å¼‚å…½: è›®ç‰›', x: 500, y: 500, desc: 'å·¦ä¸‹è§’åŒºåŸŸ' },
            { type: 'resource', name: 'èµ„æº: ç„é“çŸ¿', x: 1500, y: 1500, desc: 'å³ä¸Šè§’å¯ŒçŸ¿' },
            { type: 'special', name: 'ä¼ é€: åˆå§‹æ‘', x: 200, y: 1800, desc: 'æ–°æ‰‹å‡ºç”Ÿç‚¹' },
        ];

        // --- 4. ç”Ÿæˆæ ‡è®° ---
        const layers = {
            monster: L.layerGroup().addTo(map),
            resource: L.layerGroup().addTo(map),
            special: L.layerGroup().addTo(map)
        };

        mapData.forEach(item => {
            // Leaflet åæ ‡é¡ºåºæ˜¯ [y, x]
            const marker = L.marker([item.y, item.x])
                .bindPopup(`<b>${item.name}</b><br>${item.desc}<br><small>åæ ‡: ${item.x}, ${item.y}</small>`);
            
            // æ·»åŠ é¢œè‰²ç±»
            marker.on('add', function() {
                if(item.type === 'monster') this._icon.classList.add('icon-monster');
                if(item.type === 'resource') this._icon.classList.add('icon-resource');
                if(item.type === 'special') this._icon.classList.add('icon-special');
            });

            layers[item.type].addLayer(marker);
        });

        // --- 5. äº¤äº’åŠŸèƒ½ ---
        function toggleLayer(type) {
            if (map.hasLayer(layers[type])) {
                map.removeLayer(layers[type]);
            } else {
                map.addLayer(layers[type]);
            }
        }

        map.on('mousemove', e => {
            document.getElementById('coords').innerText = `åæ ‡: [${Math.round(e.latlng.lng)}, ${Math.round(e.latlng.lat)}]`;
        });

        map.on('click', e => {
            alert(`ä½ ç‚¹å‡»äº†åæ ‡ï¼š\nX: ${Math.round(e.latlng.lng)}\nY: ${Math.round(e.latlng.lat)}`);
        });

    </script>
</body>
</html>